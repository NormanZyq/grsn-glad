# Enhancing Graph-level Anomaly Detection by Substructure Learning

Official code of paper _Enhancing Graph-level Anomaly Detection by Substructure Learning_

Our proposed model GRSN: Graph Random Substructure Network

**Note: This project contains **GRSN** implementation and three conventional GNNs (**GCN, GAT, GraphSage**)**

## Structure
This project is implemented based on [Lightning-Hydra-Template](https://github.com/ashleve/lightning-hydra-template)

The directory structure of the project looks like this:

```
├── .github                   <- Github Actions workflows
│
├── configs                   <- Hydra configs
│   ├── callbacks                <- Callbacks configs
│   ├── data                     <- Data configs
│   ├── debug                    <- Debugging configs
│   ├── experiment               <- Experiment configs
│   ├── extras                   <- Extra utilities configs
│   ├── hparams_search           <- Hyperparameter search configs
│   ├── hydra                    <- Hydra configs
│   ├── local                    <- Local configs
│   ├── logger                   <- Logger configs
│   ├── model                    <- Model configs
│   ├── paths                    <- Project paths configs
│   ├── trainer                  <- Trainer configs
│   │
│   ├── eval.yaml             <- Main config for evaluation
│   └── train.yaml            <- Main config for training
│
├── data                   <- Project data
│
├── logs                   <- Logs generated by hydra and lightning loggers
│
├── notebooks              <- Jupyter notebooks. Naming convention is a number (for ordering),
│                             the creator's initials, and a short `-` delimited description,
│                             e.g. `1.0-jqp-initial-data-exploration.ipynb`.
│
├── scripts                <- Shell scripts
│
├── src                    <- Source code
│   ├── data                     <- Data scripts
│   ├── models                   <- Model scripts
│   ├── utils                    <- Utility scripts
│   │
│   ├── eval.py                  <- Run evaluation
│   └── train.py                 <- Run training
│
├── tests                  <- Tests of any kind
│
├── .env.example              <- Example of file for storing private environment variables
├── .gitignore                <- List of files ignored by git
├── .pre-commit-config.yaml   <- Configuration of pre-commit hooks for code formatting
├── .project-root             <- File for inferring the position of project root directory
├── environment.yaml          <- File for installing conda environment
├── Makefile                  <- Makefile with commands like `make train` or `make test`
├── pyproject.toml            <- Configuration options for testing and linting
├── requirements.txt          <- File for installing python dependencies
├── setup.py                  <- File for installing project as a package
└── README.md
```

In `model` directory, here is the configurations and corresponding model:
- `grsnc2`: our proposed model GRSN
- `gcn`: GCN
- `gat`: GAT
- `sage`: GraphSage

In `data` directory:
- `gdr`: Just serves the three basic GNNs
- `gdrcm`: GRSN's data configuration

## Reproducibility

Before starting, it is recommended to run this command and make sure you have installed all the requirements:
```shell
pip install -r requirements.txt
```
You need also check if your cuda is available and enabled in your environment, otherwise you should change the running command (see below)

You can run the code via this command template:

```shell
python src/train.py data=XXXXX model=XXXXX
```

For example,
```shell
python src/train.py data=gdrcm model=grsnc2 data.name=aids
```

But you will have to override more arguments in order to fit the dataset. Here's an incomplete example 
```shell
python src/train.py data=gdrcm model=grsnc2 data.name='PROTEINS_full' data.walk_length='[20,30,15,25,11]' data.num_sample=7 ....
```

For convenience, we have organized all the configurations into directory `experiments`, and you can just run the command like:
```shell
python src/train.py experiment=aids_grsnc2
```
**All results in the paper are reproductive based on the configurations in `experiments`**. Furthermore, the deviations are obtained by setting random seeds to 1,12,123,1234,12345.

This directory also includes the configurations for ablation study.

All models will run on GPU by default. If you expect it to run on CPU:
```shell
python src/train.py experiment=aids_grsnc2 trainer=cpu
```

## Troubleshooting

- I still cannot run the code? You may try creating the `data` directory in the project's root on your own.

## Citation

TODO
